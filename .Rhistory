triwords %>%
count(triword, sort = TRUE) %>%
filter(!is.na(triword)) %>%
slice(1:20) %>%
ggplot(aes(x = reorder(triword, n), y= n)) +
geom_bar(stat = 'identity') +
coord_flip()
# plot top 20
triwords %>%
count(triword, sort = TRUE) %>%
filter(!is.na(triword)) %>%
slice(1:20) %>%
ggplot(aes(x = reorder(triword, n), y= n)) +
geom_bar(stat = 'identity') +
coord_flip() +
xlab(NULL) +
ylab('Count')
triwords %>%
filter(
if_any(
.cols = c('word1', 'word2', 'word3'),
.fns = function(x) x == "waited"
)
)
triwords %>%
filter(
if_any(
.cols = c('word1', 'word2', 'word3'),
.fns = function(x) x == "waited"
)
) %>%
count(triword, sort = TRUE)
triwords %>%
filter(
if_any(
.cols = c('word1', 'word2', 'word3'),
.fns = function(x) x == "wait"
)
) %>%
count(triword, sort = TRUE)
triwords %>%
filter(
if_any(
.cols = c('word1', 'word2', 'word3'),
.fns = function(x) x == "service"
)
) %>%
count(triword, sort = TRUE)
triwords %>%
filter(
if_any(
.cols = c('word1', 'word2', 'word3'),
.fns = function(x) x == "time"
)
) %>%
count(triword, sort = TRUE)
triwords %>%
filter(
if_any(
.cols = c('word1', 'word2', 'word3'),
.fns = function(x) x == "face"
)
) %>%
count(triword, sort = TRUE)
# plot top 20
triwords %>%
count(triword, sort = TRUE) %>%
filter(!is.na(triword)) %>%
slice(1:20) %>%
ggplot(aes(x = reorder(triword, n), y= n)) +
geom_bar(stat = 'identity') +
coord_flip() +
xlab(NULL) +
ylab('Count')
require(igraph)
Bigram
Bigram %>%
count(biwords, sort = TRUE)
Bigram %>%
count(biwords, sort = TRUE) %>%
slice(1:,)
Bigram %>%
count(biwords, sort = TRUE) %>%
slice(1:1)
Bigram %>%
count(biwords, sort = TRUE) %>%
slice(2:n()
)
############
# i graphs #
############
Bigram %>%
count(biwords, sort = TRUE) %>%
slice(2:n()) %>%
filter(n > 20) %>%
graph_from_data_frame()
require(ggraph)
set.seed(1)
ggraph(bigram_graph, layout = "fr") +
geom_edge_link() +
geom_node_point() +
geom_node_text(aes(label = name), vjust = 1, hjust = 1)
############
# i graphs #
############
bigram_graph <- Bigram %>%
count(biwords, sort = TRUE) %>%
slice(2:n) %>%
filter(n > 20) %>%
graph_from_data_frame()
set.seed(1)
ggraph(bigram_graph, layout = "fr") +
geom_edge_link() +
geom_node_point() +
geom_node_text(aes(label = name), vjust = 1, hjust = 1)
############
# i graphs #
############
bigram_graph <- Bigram %>%
count(biwords, sort = TRUE) %>%
slice(2:n) %>%
filter(n > 10) %>%
graph_from_data_frame()
############
# i graphs #
############
bigram_graph <- Bigram %>%
count(biwords, sort = TRUE) %>%
slice(2:n) %>%
filter(n > 10) %>%
graph_from_data_frame()
############
# i graphs #
############
bigram_graph <- Bigram %>%
count(biwords, sort = TRUE) %>%
slice(2:n) %>%
filter(n > 20) %>%
graph_from_data_frame()
ggraph(bigram_graph, layout = "fr") +
geom_edge_link() +
geom_node_point() +
geom_node_text(aes(label = name), vjust = 1, hjust = 1)
############
# i graphs #
############
bigram_graph <- Bigram %>%
count(biwords, sort = TRUE) %>%
slice(2:n) %>%
filter(n > 10) %>%
graph_from_data_frame()
ggraph(bigram_graph, layout = "fr") +
geom_edge_link() +
geom_node_point() +
geom_node_text(aes(label = name), vjust = 1, hjust = 1)
par(cex = 0.8)
ggraph(bigram_graph, layout = "fr") +
geom_edge_link() +
geom_node_point() +
geom_node_text(aes(label = name), vjust = 1, hjust = 1)
Bigram %>%
count(biwords, sort = TRUE) %>%
slice(2:n) %>%
filter(n > 10) %>%
graph_from_data_frame()
Bigram
ggarrange(df %>%
ggplot(aes(x= overallRating,  group=ageGroup)) +
geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat="count") +
geom_text(aes(label = scales::percent(..prop.., accuracy = 0.1),
y= ..prop.. ), stat= "count", vjust = -.5, size = 2) +
labs(y = "Percent", fill="Satisfaction") +
facet_grid(~ageGroup) +
scale_y_continuous(labels = scales::percent) +
scale_fill_discrete(labels = levels(df$overallRating)) +
theme(axis.text.x = element_blank(), axis.ticks.x = element_blank()) +
ggtitle("Overall patient appointments satisfaction across different age groups") +
xlab('Rating'), legend= 'bottom')
cons %>%
mutate(site = 'Other') %>%
mutate(site = if_else(str_detect(waitingArea, 'AUH') == TRUE, 'AUH', site)) %>%
mutate(site = if_else(str_detect(waitingArea, 'BGH') == TRUE, 'BGH', site)) %>%
mutate(site = if_else(str_detect(waitingArea, 'RLH') == TRUE, 'RLH', site)) %>%
mutate(site = if_else(str_detect(waitingArea, 'LUH') == TRUE, 'LUH', site)) %>%
mutate(site = factor(site, levels = c('RLH','AUH','BGH', 'LUH', 'Other'))) %>%
subset(site %in% c('AUH', 'BGH', 'LUH', 'RLH', 'Other')) %>%
mutate(Date = as_date(Date)) %>%
ggplot(aes(Date, colour= site)) +
geom_freqpoly(binwidth = 7) +
scale_x_date(date_breaks = "months", date_labels = "%b") +
scale_colour_manual(values=group.colours) +
geom_vline(xintercept = as.numeric(as.Date(c("2021-01-01", "2022-01-01"))), linetype=4) +
theme(axis.text.x = element_text(size=8, angle=45)) +
ggtitle("Uptake of Attend Anywhere during 2020-2022 per site") +
ylab('Count (per week)') +
xlab("Time (Month)")
cons = read_csv('rawData/consultation.csv', skip = 6) %>%
mutate(Date = dmy_hm(`Entry Time (local)`)) %>%
mutate(month = month(Date, label = TRUE)) %>%
mutate(year = year(Date)) %>%
mutate(month = factor(month, levels = c('Jan', 'Feb', 'Mar','Apr', 'May',
'Jun', 'Jul', 'Aug',
'Sep', 'Oct', 'Nov', 'Dec'))) %>%
rename(answerTime = `Time To Answer (sec)`) %>%
rename(abandon = `Is Call Abandoned`) %>%
rename(rejoin = `# Rejoins`) %>%
rename(waitingArea = `Waiting Area`)
cons %>%
mutate(site = 'Other') %>%
mutate(site = if_else(str_detect(waitingArea, 'AUH') == TRUE, 'AUH', site)) %>%
mutate(site = if_else(str_detect(waitingArea, 'BGH') == TRUE, 'BGH', site)) %>%
mutate(site = if_else(str_detect(waitingArea, 'RLH') == TRUE, 'RLH', site)) %>%
mutate(site = if_else(str_detect(waitingArea, 'LUH') == TRUE, 'LUH', site)) %>%
mutate(site = factor(site, levels = c('RLH','AUH','BGH', 'LUH', 'Other'))) %>%
subset(site %in% c('AUH', 'BGH', 'LUH', 'RLH', 'Other')) %>%
mutate(Date = as_date(Date)) %>%
ggplot(aes(Date, colour= site)) +
geom_freqpoly(binwidth = 7) +
scale_x_date(date_breaks = "months", date_labels = "%b") +
scale_colour_manual(values=group.colours) +
geom_vline(xintercept = as.numeric(as.Date(c("2021-01-01", "2022-01-01"))), linetype=4) +
theme(axis.text.x = element_text(size=8, angle=45)) +
ggtitle("Uptake of Attend Anywhere during 2020-2022 per site") +
ylab('Count (per week)') +
xlab("Time (Month)")
group.colours = c('RLH' = 'red',
'AUH' = 'orange',
'BGH' = 'green',
'LUH' = 'blue',
'Other' = 'grey')
cons %>%
mutate(site = 'Other') %>%
mutate(site = if_else(str_detect(waitingArea, 'AUH') == TRUE, 'AUH', site)) %>%
mutate(site = if_else(str_detect(waitingArea, 'BGH') == TRUE, 'BGH', site)) %>%
mutate(site = if_else(str_detect(waitingArea, 'RLH') == TRUE, 'RLH', site)) %>%
mutate(site = if_else(str_detect(waitingArea, 'LUH') == TRUE, 'LUH', site)) %>%
mutate(site = factor(site, levels = c('RLH','AUH','BGH', 'LUH', 'Other'))) %>%
subset(site %in% c('AUH', 'BGH', 'LUH', 'RLH', 'Other')) %>%
mutate(Date = as_date(Date)) %>%
ggplot(aes(Date, colour= site)) +
geom_freqpoly(binwidth = 7) +
scale_x_date(date_breaks = "months", date_labels = "%b") +
scale_colour_manual(values=group.colours) +
geom_vline(xintercept = as.numeric(as.Date(c("2021-01-01", "2022-01-01"))), linetype=4) +
theme(axis.text.x = element_text(size=8, angle=45)) +
ggtitle("Uptake of Attend Anywhere during 2020-2022 per site") +
ylab('Count (per week)') +
xlab("Time (Month)")
??%--%
Bigram = df %>%
filter(!is.na(comments)) %>%
select(patId, (comments)) %>%
unnest_tokens(trigram, comments, token = "ngrams", n = 1) %>%
separate(trigram, c("word1"), sep = " ") %>%
filter(!word1 %in% stopwords_filter$word) %>%
filter(!is.na(word1)) %>%
group_by(patId) %>%
summarise(words = str_c(word1, collapse = " ")) %>%
ungroup() %>%
unnest_tokens(trigram, words, token = "ngrams", n = 2) %>%
mutate(biwords = trigram) %>%
separate(trigram, c('word1', 'word2'), ' ')
View(Bigram)
bigram_graph <- Bigram %>%
select(-biwords) %>%
count(biwords, sort = TRUE) %>%
slice(2:n) %>%
filter(n > 10) %>%
graph_from_data_frame()
colnames(Bigram)
bigram_graph <- Bigram %>%
count(biwords, sort = TRUE) %>%
select(-biwords) %>%
slice(2:n) %>%
filter(n > 10) %>%
graph_from_data_frame()
bigram_graph <- Bigram %>%
count(biwords, sort = TRUE) %>%
select(-biwords) %>%
filter(n > 10) %>%
graph_from_data_frame()
Bigram %>%
count(biwords, sort = TRUE) %>%
select(-biwords) %>%
filter(n > 10) %>%
graph_from_data_frame()
Bigram %>%
count(biwords, sort = TRUE) %>%
select(-biwords)
Bigram %>%
count(biwords, sort = TRUE)
bigram_graph <- Bigram %>%
count(biwords, sort = TRUE) %>%
separate(biwords, c('word1', 'word2', ' ')) %>%
select(-biwords) %>%
filter(n > 10) %>%
graph_from_data_frame()
par(cex = 0.8)
ggraph(bigram_graph, layout = "fr") +
geom_edge_link() +
geom_node_point() +
geom_node_text(aes(label = name), vjust = 1, hjust = 1)
bigram_graph <- Bigram %>%
count(biwords, sort = TRUE) %>%
separate(biwords, c('word1', 'word2', ' ')) %>%
select(-biwords)
Bigram %>%
count(biwords, sort = TRUE) %>%
separate(biwords, c('word1', 'word2', ' ')) %>%
select(-biwords)
Bigram %>%
count(biwords, sort = TRUE) %>%
separate(biwords, c('word1', 'word2', ' '))
bigram_graph <- Bigram %>%
count(biwords, sort = TRUE) %>%
separate(biwords, c('word1', 'word2'), ' ') %>%
select(-biwords) %>%
filter(n > 10) %>%
graph_from_data_frame()
Bigram
Bigram %>%
count(biwords, sort = TRUE)
Bigram %>%
count(biwords, sort = TRUE) %>%
separate(biwords, c('word1', 'word2'), ' ')
bigram_graph <- Bigram %>%
count(biwords, sort = TRUE) %>%
separate(biwords, c('word1', 'word2'), ' ') %>%
filter(n > 10) %>%
graph_from_data_frame()
set.seed(1)
ggraph(bigram_graph, layout = "fr") +
geom_edge_link() +
geom_node_point() +
geom_node_text(aes(label = name), vjust = 1, hjust = 1)
bigram_graph <- Bigram %>%
count(biwords, sort = TRUE) %>%
separate(biwords, c('word1', 'word2'), ' ') %>%
filter(n > 15) %>%
graph_from_data_frame()
par(cex = 0.8)
ggraph(bigram_graph, layout = "fr") +
geom_edge_link() +
geom_node_point() +
geom_node_text(aes(label = name), vjust = 1, hjust = 1)
bigram_graph <- Bigram %>%
count(biwords, sort = TRUE) %>%
separate(biwords, c('word1', 'word2'), ' ') %>%
filter(n > 5) %>%
graph_from_data_frame()
colnames(Bigram)
set.seed(1)
par(cex = 0.8)
ggraph(bigram_graph, layout = "fr") +
geom_edge_link() +
geom_node_point() +
geom_node_text(aes(label = name), vjust = 1, hjust = 1)
bigram_graph <- Bigram %>%
count(biwords, sort = TRUE) %>%
separate(biwords, c('word1', 'word2'), ' ') %>%
filter(n > 8) %>%
graph_from_data_frame()
ggraph(bigram_graph, layout = "fr") +
geom_edge_link() +
geom_node_point() +
geom_node_text(aes(label = name), vjust = 1, hjust = 1)
bigram_graph <- Bigram %>%
count(biwords, sort = TRUE) %>%
separate(biwords, c('word1', 'word2'), ' ') %>%
filter(n > 7) %>%
graph_from_data_frame()
set.seed(1)
par(cex = 0.8)
ggraph(bigram_graph, layout = "fr") +
geom_edge_link() +
geom_node_point() +
geom_node_text(aes(label = name), vjust = 1, hjust = 1)
a <- grid::arrow(type = "closed", length = unit(.1, "inches"))
set.seed(1)
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(edge_alpha = n), show.legend = FALSE,
arrow = a, end_cap = circle(.07, 'inches')) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name), vjust = 1, hjust = 1, size = 3) +
theme_void() +
ggtitle("bigram network, n>4")
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(width = occur),          # seems the alpha creates problem with legend
colour = "cyan4") +
geom_node_point(size = 5) +
scale_edge_width(range = c(0.2, 2)) +       # rescale the edges
geom_node_text(aes(label = name), repel = TRUE, point.padding = unit(0.2, "lines"))+
theme_graph()                                # made for graph
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(edge_alpha = n), show.legend = TRUE,
arrow = a, end_cap = circle(.07, 'inches')) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name), vjust = 1, hjust = 1, size = 3) +
theme_void() +
ggtitle("bigram network, n>4")
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(edge_alpha = n), show.legend = TRUE)#,
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(edge_alpha = n), show.legend = TRUE,
arrow = a, end_cap = circle(.07, 'inches')) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name), vjust = 1, hjust = 1, size = 3) +
theme_void() +
ggtitle("bigram network, n>4")
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(edge_alpha = n), show.legend = TRUE) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name), vjust = 1, hjust = 1, size = 3) +
theme_void() +
ggtitle("bigram network, n>4")
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(edge_alpha = n), show.legend = TRUE, colour = 'cyan4') +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name), vjust = 1, hjust = 1, size = 3) +
theme_void() +
ggtitle("bigram network, n>4")
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(edge_alpha = n), show.legend = TRUE, colour = 'cyan4',
arrow = a, end_cap = circle(.07, 'inches')) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name), vjust = 1, hjust = 1, size = 3) +
theme_void() +
ggtitle("bigram network, n>4")
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(edge_alpha = n), show.legend = TRUE,
arrow = a, end_cap = circle(.07, 'inches')) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name), vjust = 1, hjust = 1, size = 3) +
theme_void() +
ggtitle("bigram network, n>4")
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(edge_alpha = n), show.legend = TRUE,
arrow = a, end_cap = circle(.07, 'inches'), check_overlap = TRUE) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name), vjust = 1, hjust = 1, size = 3) +
theme_void() +
ggtitle("bigram network, n>4")
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(edge_alpha = n), show.legend = TRUE,
arrow = a, end_cap = circle(.07, 'inches'), check_overlap = TRUE) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name), vjust = 1, hjust = 1, size = 3) +
theme_void() +
ggtitle("bigram network, n>4")
set.seed(1)
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(edge_alpha = n), show.legend = TRUE,
arrow = a, end_cap = circle(.07, 'inches'), check_overlap = TRUE) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name), vjust = 1, hjust = 1, size = 3) +
theme_void() +
ggtitle("bigram network, n>4")
set.seed(1)
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(edge_alpha = n), show.legend = TRUE,
arrow = a, end_cap = circle(.07, 'inches'), check_overlap = TRUE) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name), vjust = 1, hjust = 1, size = 3) +
theme_void() +
ggtitle("bigram network, n>4")
set.seed(1)
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(edge_alpha = n), show.legend = TRUE,
arrow = a, end_cap = circle(.07, 'inches'), check_overlap = FALSE) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name), vjust = 1, hjust = 1, size = 3) +
theme_void() +
ggtitle("bigram network, n>4")
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(alpha = n), show.legend = TRUE, colour = 'cyan4',
arrow = a, end_cap = circle(.07, 'inches')) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name), vjust = 1, hjust = 1, size = 3) +
theme_void() +
ggtitle("bigram network, n>4")
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(alpha = stat(n)), show.legend = TRUE, colour = 'cyan4',
arrow = a, end_cap = circle(.07, 'inches')) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name), vjust = 1, hjust = 1, size = 3) +
theme_void() +
ggtitle("bigram network, n>4")
a <- grid::arrow(type = "closed", length = unit(.1, "inches"))
set.seed(1)
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(edge_alpha = n), show.legend = TRUE,
arrow = a, end_cap = circle(.07, 'inches'), check_overlap = FALSE) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name), vjust = 1, hjust = 1, size = 3) +
theme_void() +
ggtitle("bigram network, n>4")
set.seed(1)
ggraph(bigram_graph, layout = "fr") +
geom_edge_link(aes(edge_alpha = n), show.legend = TRUE,
arrow = a, end_cap = circle(.07, 'inches'), check_overlap = FALSE) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(aes(label = name), vjust = 1, hjust = 1, size = 3) +
theme_void() +
ggtitle("bigram network, n > 7")
triwords %>%
filter(
if_any(
.cols = c('word1', 'word2', 'word3'),
.fns = function(x) x == "face"
)
) %>%
count(triword, sort = TRUE)
