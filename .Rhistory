filter(n > freq) %>% # filter freq accordingly
filter(word != 'na') %>%
mutate(word = reorder(word,n))
plot1 = ggplot(data = text_wordcounts, aes(word, n)) +
geom_col(fill= 'darkred') +
coord_flip() +
geom_text(aes(label = n), hjust = 1.2, colour = 'white', fontface = 'bold') +
ggtitle(sprintf("Most common words from patient comments who rated\n access satisfaction as '%s'", satisfaction)) +
theme(plot.title = element_text(hjust = 0.5))
return(plot1)
}
else {
df_filter = df %>%
filter(overallRating == satisfaction)
# extract comments
comment = df_filter$comments
# tidy data
# remove stop words
comment = comment %>%
str_replace_all(pattern = stopwords('english'), replacement = "") # remove stop words
# other changes
comment = paste(comment, collapse = " ")
comment = str_replace_all(comment, pattern = '\"', replacement = "") # Remove slashes
comment = str_replace_all(comment, pattern = '\n', replacement = "") # Remove \n
comment = str_replace_all(comment, pattern = '\u0092', replacement = "'") #Replace with quote
comment = str_replace_all(comment, pattern = '\u0091', replacement = "'") #Replace with quote
#Create dataframe
text_df = data_frame(Text = comment)
text_words = text_df %>%
unnest_tokens(output = word, input = Text)
text_words  = text_words  %>%
anti_join(stop_words) # Remove stop words (perhaps unnecessary)
text_wordcounts = text_words  %>%
count(word, sort = TRUE)
## plot common words ###
#* Currently set to min freq 100
text_wordcounts = text_wordcounts %>%
filter(n > freq) %>% # filter freq accordingly
filter(word != 'na') %>%
mutate(word = reorder(word,n))
plot1 = ggplot(data = text_wordcounts, aes(word, n)) +
geom_col(fill= 'darkred') +
coord_flip() +
geom_text(aes(label = n), hjust = 1.2, colour = 'white', fontface = 'bold') +
ggtitle(sprintf("Most common words from patient comments who rated\n overall satisfaction as '%s'", satisfaction)) +
theme(plot.title = element_text(hjust = 0.5))
return(plot1)
}
}
levels(df$overallRating)[5]
levels(df$overallRating)[3]
levels(df$accessRating)[1]
levels(df$overallRating)[1]
Plot2('overall', levels(df$overallRating)[3], 30)
require(tidytext)
require(tm)
require(wordcloud)
library(tidytext) # For unnest_tokens
library(stringr) # For managing text
Plot2('overall', levels(df$overallRating)[3], 30)
Plot2('overall', levels(df$overallRating)[1], 30)
Plot2('overall', levels(df$overallRating)[1], 20)
Plot2('overall', levels(df$overallRating)[1], 10)
Plot2('overall', levels(df$overallRating)[1], 15)
Plot2('overall', levels(df$overallRating)[1], 14)
levels(df$overallRating)[3]
plot1 = ggplot(data = text_wordcounts, aes(word, n)) +
geom_col(fill= 'darkred') +
coord_flip() +
geom_text(aes(label = n), hjust = 1.2, colour = 'white', fontface = 'bold') +
ggtitle(sprintf("Most common words from patient comments who rated\n overall satisfaction as '%s'", satisfaction)) +
theme(plot.title = element_text(hjust = 0.5)) +
xlab('Frequency') +
ylab(NULL)
Plot2 = function(accessOrOverall, satisfaction, freq) {
if (accessOrOverall == 'access'){
df_filter = df %>%
filter(accessRating == satisfaction)
# extract comments
comment = df_filter$comments
# tidy data
# remove stop words
comment = comment %>%
str_replace_all(pattern = stopwords('english'), replacement = "") #%>%  # remove stop words
#str_replace_all(string = x, pattern = '[123456789]', replacement = '') # remove numbers
# other changes
comment = paste(comment, collapse = " ")
comment = str_replace_all(comment, pattern = '\"', replacement = "") # Remove slashes
comment = str_replace_all(comment, pattern = '\n', replacement = "") # Remove \n
comment = str_replace_all(comment, pattern = '\u0092', replacement = "'") #Replace with quote
comment = str_replace_all(comment, pattern = '\u0091', replacement = "'") #Replace with quote
#Create dataframe
text_df = data_frame(Text = comment)
text_words = text_df %>%
unnest_tokens(output = word, input = Text)
text_words  = text_words  %>%
anti_join(stop_words) # Remove stop words (perhaps unnecessary)
text_wordcounts = text_words  %>%
count(word, sort = TRUE)
## plot common words ###
#* Currently set to min freq 100
text_wordcounts = text_wordcounts %>%
filter(n > freq) %>% # filter freq accordingly
filter(word != 'na') %>%
mutate(word = reorder(word,n))
plot1 = ggplot(data = text_wordcounts, aes(word, n)) +
geom_col(fill= 'darkred') +
coord_flip() +
geom_text(aes(label = n), hjust = 1.2, colour = 'white', fontface = 'bold') +
ggtitle(sprintf("Most common words from patient comments who rated\n access satisfaction as '%s'", satisfaction)) +
theme(plot.title = element_text(hjust = 0.5))
return(plot1)
}
else {
df_filter = df %>%
filter(overallRating == satisfaction)
# extract comments
comment = df_filter$comments
# tidy data
# remove stop words
comment = comment %>%
str_replace_all(pattern = stopwords('english'), replacement = "") # remove stop words
# other changes
comment = paste(comment, collapse = " ")
comment = str_replace_all(comment, pattern = '\"', replacement = "") # Remove slashes
comment = str_replace_all(comment, pattern = '\n', replacement = "") # Remove \n
comment = str_replace_all(comment, pattern = '\u0092', replacement = "'") #Replace with quote
comment = str_replace_all(comment, pattern = '\u0091', replacement = "'") #Replace with quote
#Create dataframe
text_df = data_frame(Text = comment)
text_words = text_df %>%
unnest_tokens(output = word, input = Text)
text_words  = text_words  %>%
anti_join(stop_words) # Remove stop words (perhaps unnecessary)
text_wordcounts = text_words  %>%
count(word, sort = TRUE)
## plot common words ###
#* Currently set to min freq 100
text_wordcounts = text_wordcounts %>%
filter(n > freq) %>% # filter freq accordingly
filter(word != 'na') %>%
mutate(word = reorder(word,n))
plot1 = ggplot(data = text_wordcounts, aes(word, n)) +
geom_col(fill= 'darkred') +
coord_flip() +
geom_text(aes(label = n), hjust = 1.2, colour = 'white', fontface = 'bold') +
ggtitle(sprintf("Most common words from patient comments who rated\n overall satisfaction as '%s'", satisfaction)) +
theme(plot.title = element_text(hjust = 0.5)) +
xlab('Frequency') +
ylab(NULL)
return(plot1)
}
}
##* look through different satisfaction by changing number in [] from 1 (very
##* disasisfied) to 5 (very satisfied) and access/overall satisfaction
f_comSat = Plot2('overall', levels(df$overallRating)[3], 30)
f_comDissat = Plot2('overall', levels(df$overallRating)[1], 14)
f_comSat
Plot2 = function(accessOrOverall, satisfaction, freq) {
if (accessOrOverall == 'access'){
df_filter = df %>%
filter(accessRating %in% satisfaction)
# extract comments
comment = df_filter$comments
# tidy data
# remove stop words
comment = comment %>%
str_replace_all(pattern = stopwords('english'), replacement = "") #%>%  # remove stop words
#str_replace_all(string = x, pattern = '[123456789]', replacement = '') # remove numbers
# other changes
comment = paste(comment, collapse = " ")
comment = str_replace_all(comment, pattern = '\"', replacement = "") # Remove slashes
comment = str_replace_all(comment, pattern = '\n', replacement = "") # Remove \n
comment = str_replace_all(comment, pattern = '\u0092', replacement = "'") #Replace with quote
comment = str_replace_all(comment, pattern = '\u0091', replacement = "'") #Replace with quote
#Create dataframe
text_df = data_frame(Text = comment)
text_words = text_df %>%
unnest_tokens(output = word, input = Text)
text_words  = text_words  %>%
anti_join(stop_words) # Remove stop words (perhaps unnecessary)
text_wordcounts = text_words  %>%
count(word, sort = TRUE)
## plot common words ###
#* Currently set to min freq 100
text_wordcounts = text_wordcounts %>%
filter(n > freq) %>% # filter freq accordingly
filter(word != 'na') %>%
mutate(word = reorder(word,n))
plot1 = ggplot(data = text_wordcounts, aes(word, n)) +
geom_col(fill= 'darkred') +
coord_flip() +
geom_text(aes(label = n), hjust = 1.2, colour = 'white', fontface = 'bold') +
ggtitle(sprintf("Most common words from patient comments who rated\n access satisfaction as '%s'", satisfaction)) +
theme(plot.title = element_text(hjust = 0.5))
return(plot1)
}
else {
df_filter = df %>%
filter(overallRating %in% satisfaction)
# extract comments
comment = df_filter$comments
# tidy data
# remove stop words
comment = comment %>%
str_replace_all(pattern = stopwords('english'), replacement = "") # remove stop words
# other changes
comment = paste(comment, collapse = " ")
comment = str_replace_all(comment, pattern = '\"', replacement = "") # Remove slashes
comment = str_replace_all(comment, pattern = '\n', replacement = "") # Remove \n
comment = str_replace_all(comment, pattern = '\u0092', replacement = "'") #Replace with quote
comment = str_replace_all(comment, pattern = '\u0091', replacement = "'") #Replace with quote
#Create dataframe
text_df = data_frame(Text = comment)
text_words = text_df %>%
unnest_tokens(output = word, input = Text)
text_words  = text_words  %>%
anti_join(stop_words) # Remove stop words (perhaps unnecessary)
text_wordcounts = text_words  %>%
count(word, sort = TRUE)
## plot common words ###
#* Currently set to min freq 100
text_wordcounts = text_wordcounts %>%
filter(n > freq) %>% # filter freq accordingly
filter(word != 'na') %>%
mutate(word = reorder(word,n))
plot1 = ggplot(data = text_wordcounts, aes(word, n)) +
geom_col(fill= 'darkred') +
coord_flip() +
geom_text(aes(label = n), hjust = 1.2, colour = 'white', fontface = 'bold') +
ggtitle(sprintf("Most common words from patient comments who rated\n overall satisfaction as '%s'", satisfaction)) +
theme(plot.title = element_text(hjust = 0.5)) +
xlab('Frequency') +
ylab(NULL)
return(plot1)
}
}
Plot2('overall', levels(df$overallRating)[3], 30)
Plot2 = function(accessOrOverall, satisfaction, freq) {
if (accessOrOverall == 'access'){
df_filter = df %>%
filter(accessRating %in% satisfaction)
# extract comments
comment = df_filter$comments
# tidy data
# remove stop words
comment = comment %>%
str_replace_all(pattern = stopwords('english'), replacement = "") #%>%  # remove stop words
#str_replace_all(string = x, pattern = '[123456789]', replacement = '') # remove numbers
# other changes
comment = paste(comment, collapse = " ")
comment = str_replace_all(comment, pattern = '\"', replacement = "") # Remove slashes
comment = str_replace_all(comment, pattern = '\n', replacement = "") # Remove \n
comment = str_replace_all(comment, pattern = '\u0092', replacement = "'") #Replace with quote
comment = str_replace_all(comment, pattern = '\u0091', replacement = "'") #Replace with quote
#Create dataframe
text_df = data_frame(Text = comment)
text_words = text_df %>%
unnest_tokens(output = word, input = Text)
text_words  = text_words  %>%
anti_join(stop_words) # Remove stop words (perhaps unnecessary)
text_wordcounts = text_words  %>%
count(word, sort = TRUE)
## plot common words ###
#* Currently set to min freq 100
text_wordcounts = text_wordcounts %>%
filter(n > freq) %>% # filter freq accordingly
filter(word != 'na') %>%
mutate(word = reorder(word,n))
plot1 = ggplot(data = text_wordcounts, aes(word, n)) +
geom_col(fill= 'darkred') +
coord_flip() +
geom_text(aes(label = n), hjust = 1.2, colour = 'white', fontface = 'bold') +
ggtitle(sprintf("Most common words from patient comments who rated\n access satisfaction as '%s'", satisfaction)) +
theme(plot.title = element_text(hjust = 0.5))
return(plot1)
}
else {
df_filter = df %>%
filter(overallRating %in% satisfaction)
# extract comments
comment = df_filter$comments
# tidy data
# remove stop words
comment = comment %>%
str_replace_all(pattern = stopwords('english'), replacement = "") # remove stop words
# other changes
comment = paste(comment, collapse = " ")
comment = str_replace_all(comment, pattern = '\"', replacement = "") # Remove slashes
comment = str_replace_all(comment, pattern = '\n', replacement = "") # Remove \n
comment = str_replace_all(comment, pattern = '\u0092', replacement = "'") #Replace with quote
comment = str_replace_all(comment, pattern = '\u0091', replacement = "'") #Replace with quote
#Create dataframe
text_df = data_frame(Text = comment)
text_words = text_df %>%
unnest_tokens(output = word, input = Text)
text_words  = text_words  %>%
anti_join(stop_words) # Remove stop words (perhaps unnecessary)
text_wordcounts = text_words  %>%
count(word, sort = TRUE)
## plot common words ###
#* Currently set to min freq 100
text_wordcounts = text_wordcounts %>%
filter(n > freq) %>% # filter freq accordingly
filter(word != 'na') %>%
mutate(word = reorder(word,n))
plot1 = ggplot(data = text_wordcounts, aes(word, n)) +
geom_col(fill= 'darkred') +
coord_flip() +
geom_text(aes(label = n), hjust = 1.2, colour = 'white', fontface = 'bold') +
ggtitle(sprintf("Most common words from patient comments who rated\n overall satisfaction as '%s'", satisfaction)) +
theme(plot.title = element_text(hjust = 0.5)) +
xlab('Frequency') +
ylab(NULL)
return(plot1)
}
}
##* look through different satisfaction by changing number in [] from 1 (very
##* disasisfied) to 5 (very satisfied) and access/overall satisfaction
f_comSat = Plot2('overall', levels(df$overallRating)[3], 30)
f_comDissat = Plot2('overall', levels(df$overallRating)[1], 14)
f_comDissat
Plot2('overall', levels(df$overallRating)[1], 14)
Plot2 = function(accessOrOverall, satisfaction, freq) {
if (accessOrOverall == 'access'){
df_filter = df %>%
filter(accessRating %in% satisfaction)
# extract comments
comment = df_filter$comments
# tidy data
# remove stop words
comment = comment %>%
str_replace_all(pattern = stopwords('english'), replacement = "") #%>%  # remove stop words
#str_replace_all(string = x, pattern = '[123456789]', replacement = '') # remove numbers
# other changes
comment = paste(comment, collapse = " ")
comment = str_replace_all(comment, pattern = '\"', replacement = "") # Remove slashes
comment = str_replace_all(comment, pattern = '\n', replacement = "") # Remove \n
comment = str_replace_all(comment, pattern = '\u0092', replacement = "'") #Replace with quote
comment = str_replace_all(comment, pattern = '\u0091', replacement = "'") #Replace with quote
#Create dataframe
text_df = data_frame(Text = comment)
text_words = text_df %>%
unnest_tokens(output = word, input = Text)
text_words  = text_words  %>%
anti_join(stop_words) # Remove stop words (perhaps unnecessary)
text_wordcounts = text_words  %>%
count(word, sort = TRUE)
## plot common words ###
#* Currently set to min freq 100
text_wordcounts = text_wordcounts %>%
filter(n > freq) %>% # filter freq accordingly
filter(word != 'na') %>%
mutate(word = reorder(word,n))
plot1 = ggplot(data = text_wordcounts, aes(word, n)) +
geom_col(fill= 'darkred') +
coord_flip() +
geom_text(aes(label = n), hjust = 1.2, colour = 'white', fontface = 'bold') +
ggtitle(sprintf("Most common words from patient comments who rated\n access satisfaction as '%s'", satisfaction)) +
theme(plot.title = element_text(hjust = 0.5))
return(plot1)
}
else {
df_filter = df %>%
filter(overallRating %in% satisfaction)
# extract comments
comment = df_filter$comments
# tidy data
# remove stop words
comment = comment %>%
str_replace_all(pattern = stopwords('english'), replacement = "") # remove stop words
# other changes
comment = paste(comment, collapse = " ")
comment = str_replace_all(comment, pattern = '\"', replacement = "") # Remove slashes
comment = str_replace_all(comment, pattern = '\n', replacement = "") # Remove \n
comment = str_replace_all(comment, pattern = '\u0092', replacement = "'") #Replace with quote
comment = str_replace_all(comment, pattern = '\u0091', replacement = "'") #Replace with quote
#Create dataframe
text_df = data_frame(Text = comment)
text_words = text_df %>%
unnest_tokens(output = word, input = Text)
text_words  = text_words  %>%
anti_join(stop_words) # Remove stop words (perhaps unnecessary)
text_wordcounts = text_words  %>%
count(word, sort = TRUE)
## plot common words ###
#* Currently set to min freq 100
text_wordcounts = text_wordcounts %>%
filter(n > freq) %>% # filter freq accordingly
filter(word != 'na') %>%
mutate(word = reorder(word,n))
plot1 = ggplot(data = text_wordcounts, aes(word, n)) +
geom_col(fill= 'darkred') +
coord_flip() +
geom_text(aes(label = n), hjust = 1.2, colour = 'white', fontface = 'bold') +
ggtitle(sprintf("Most common words from patient comments who rated\n overall satisfaction as '%s'", satisfaction)) +
theme(plot.title = element_text(hjust = 0.5)) +
ylab('Frequency') +
xlab(NULL)
return(plot1)
}
}
Plot2('overall', levels(df$overallRating)[3], 30)
Plot2('overall', levels(df$overallRating)[1], 14)
Plot2('overall', levels(df$overallRating)[1], 12)
f_comDissat = Plot2('overall', levels(df$overallRating)[1], 14)
Plot2('overall', levels(df$overallRating)[1], 14)
ggarrange(f_comSat,f_comDissat)
plot1 = ggplot(data = text_wordcounts, aes(word, n)) +
geom_col(fill= 'darkred') +
coord_flip() +
geom_text(aes(label = n), hjust = 1.2, colour = 'white', fontface = 'bold') +
ggtitle(sprintf("%s", satisfaction)) +
theme(plot.title = element_text(hjust = 0.5)) +
ylab('Frequency') +
xlab(NULL)
Plot2 = function(accessOrOverall, satisfaction, freq) {
if (accessOrOverall == 'access'){
df_filter = df %>%
filter(accessRating %in% satisfaction)
# extract comments
comment = df_filter$comments
# tidy data
# remove stop words
comment = comment %>%
str_replace_all(pattern = stopwords('english'), replacement = "") #%>%  # remove stop words
#str_replace_all(string = x, pattern = '[123456789]', replacement = '') # remove numbers
# other changes
comment = paste(comment, collapse = " ")
comment = str_replace_all(comment, pattern = '\"', replacement = "") # Remove slashes
comment = str_replace_all(comment, pattern = '\n', replacement = "") # Remove \n
comment = str_replace_all(comment, pattern = '\u0092', replacement = "'") #Replace with quote
comment = str_replace_all(comment, pattern = '\u0091', replacement = "'") #Replace with quote
#Create dataframe
text_df = data_frame(Text = comment)
text_words = text_df %>%
unnest_tokens(output = word, input = Text)
text_words  = text_words  %>%
anti_join(stop_words) # Remove stop words (perhaps unnecessary)
text_wordcounts = text_words  %>%
count(word, sort = TRUE)
## plot common words ###
#* Currently set to min freq 100
text_wordcounts = text_wordcounts %>%
filter(n > freq) %>% # filter freq accordingly
filter(word != 'na') %>%
mutate(word = reorder(word,n))
plot1 = ggplot(data = text_wordcounts, aes(word, n)) +
geom_col(fill= 'darkred') +
coord_flip() +
geom_text(aes(label = n), hjust = 1.2, colour = 'white', fontface = 'bold') +
ggtitle(sprintf("Most common words from patient comments who rated\n access satisfaction as '%s'", satisfaction)) +
theme(plot.title = element_text(hjust = 0.5))
return(plot1)
}
else {
df_filter = df %>%
filter(overallRating %in% satisfaction)
# extract comments
comment = df_filter$comments
# tidy data
# remove stop words
comment = comment %>%
str_replace_all(pattern = stopwords('english'), replacement = "") # remove stop words
# other changes
comment = paste(comment, collapse = " ")
comment = str_replace_all(comment, pattern = '\"', replacement = "") # Remove slashes
comment = str_replace_all(comment, pattern = '\n', replacement = "") # Remove \n
comment = str_replace_all(comment, pattern = '\u0092', replacement = "'") #Replace with quote
comment = str_replace_all(comment, pattern = '\u0091', replacement = "'") #Replace with quote
#Create dataframe
text_df = data_frame(Text = comment)
text_words = text_df %>%
unnest_tokens(output = word, input = Text)
text_words  = text_words  %>%
anti_join(stop_words) # Remove stop words (perhaps unnecessary)
text_wordcounts = text_words  %>%
count(word, sort = TRUE)
## plot common words ###
#* Currently set to min freq 100
text_wordcounts = text_wordcounts %>%
filter(n > freq) %>% # filter freq accordingly
filter(word != 'na') %>%
mutate(word = reorder(word,n))
plot1 = ggplot(data = text_wordcounts, aes(word, n)) +
geom_col(fill= 'darkred') +
coord_flip() +
geom_text(aes(label = n), hjust = 1.2, colour = 'white', fontface = 'bold') +
ggtitle(sprintf("%s", satisfaction)) +
theme(plot.title = element_text(hjust = 0.5)) +
ylab('Frequency') +
xlab(NULL)
return(plot1)
}
}
##* look through different satisfaction by changing number in [] from 1 (very
##* disasisfied) to 5 (very satisfied) and access/overall satisfaction
f_comSat = Plot2('overall', levels(df$overallRating)[3], 30)
f_comDissat = Plot2('overall', levels(df$overallRating)[1], 14)
ggarrange(f_comSat,f_comDissat)
df %>%
ggplot(aes(x= overallRating,  group=ageGroup)) +
geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat="count") +
geom_text(aes(label = scales::percent(..prop.., accuracy = 0.1),
y= ..prop.. ), stat= "count", vjust = -.5, size = 2) +
labs(y = "Percent", fill="Satisfaction") +
facet_grid(~ageGroup) +
scale_y_continuous(labels = scales::percent) +
scale_fill_discrete(labels = levels(df$overallRating)) +
theme(axis.text.x = element_blank(), axis.ticks.x = element_blank()) +
ggtitle("Patient Satisfaction\nOverall patient appointments satisfaction across different age groups") +
xlab('Rating')
